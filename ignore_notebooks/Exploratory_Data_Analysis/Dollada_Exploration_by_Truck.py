merge['EquipmentID'] = merge['EquipmentID'].astype(str)
merge['EventTimeStamp'] = pd.to_datetime(merge['EventTimeStamp'], errors='coerce')
# Unique Equipment IDs with spn==5246
equipment_ids = [
    '1630', '1487', '1329', '1419', '1486', '1509', '1492', '1473', '1383', '1396', '1431', '1795', '1366', '1339',
    '1391', '1399', '1417', '1591', '1490', '1547', '1444', '1437', '1453', '1692', '1590', '1418', '1472', '1560',
    '1572', '1375', '1742', '1566', '1778', '305', '1659', '1403', '1535', '1524', '1567', '1373', '1665', '1551',
    '1440', '1571', '1443', '1378', '1452', '1488', '1384', '304', '1582', '1508', '1395', '1599', '1501', '1407',
    '1603', '1604', '1477', '1389', '1519', '1757', '1458', '1401', '1579', '1534', '1575', '1539', '1601', '1657',
    '1592', '1563', '1557', '1605', '1581', '301', '1811', '1573', '1668', '1643', '1561', '1549', '1940', '1839',
    '1552', '1637', '1554', '1529', '1686', '1598', '1745', '1525', '1848', '1537', '1521', '1661', '1831', '1528',
    '1595', '1654', '1543', '1812', '1803', '1814', '1556', '1564', '1585', '1602', '1663', '1623', '1800', '1823',
    '1818', '1586', '2009', '1946', '1749', '1746', '1559', '1711', '1600', '1584', '1939', '1704', '1808', '1743',
    '1822', '1739', '1764', '1846', '2007', '1669', '1819', '105427203', '1780', '2143', '1718', '2111', '1874',
    '1689', '1932', '1794', '1978', '1691', '105349576', '1942', '1928', '1921', '1860', '1877', '1878', '306',
    '1853', '1748', '1758', '1919', '1958', '1683', '2209', '1847', '1815', '2082', '1698', '1827', '1857', '1918',
    '1751', '1961', '1985', '1828', '1964', '1768', '1834', '1970', '1896', '2109', '1797', '1951', '1945', '1864',
    '2004', '1858', '1922', '1991', '2021', '1907', '1947', '2089', '2211', '302', '2175', '1854', '1872'
]
plots_per_page = 9
for page in range(-(-len(equipment_ids) // plots_per_page)):
    fig, axes = plt.subplots(3, 3, figsize=(18, 12))
    for idx, ax in enumerate(axes.flatten()):
        i = page * plots_per_page + idx
        if i >= len(equipment_ids):
            ax.axis('off')
            continue
        df = merge.loc[merge['EquipmentID'] == equipment_ids[i]].sort_values('EventTimeStamp')
        if df.empty:
            ax.axis('off')
            continue
        ax.plot(df['EventTimeStamp'], [1]*len(df), '|', markersize=10)
        ax.plot(df.loc[df['spn'] == 5246, 'EventTimeStamp'], [1]*df['spn'].eq(5246).sum(), 'ro', markersize=8)
        ax.set_title(f'EquipmentID {equipment_ids[i]}', fontsize=10)
        ax.set_yticks([])
        ax.grid(True)
    plt.tight_layout()
    plt.show()